# 自适应检测配置模板
# Adaptive Detection Configuration Template
#
# 用于 infer_stage1_adaptive() 的参数配置

# ==================== 自适应检测配置 ====================
adaptive_detection:
  # 粗扫描参数
  coarse_imgsz: 640          # 粗扫描分辨率
  coarse_conf: 0.08          # 粗扫描置信度阈值 (低阈值捕获更多候选)
  
  # 精细扫描参数
  fine_imgsz: 1280           # 精细扫描分辨率
  fine_conf: 0.3             # 精细扫描置信度阈值
  
  # DBSCAN 聚类参数
  cluster_eps: 100.0         # eps 参数 (像素距离)，根据腔室间距调整
  cluster_min_samples: 3     # 最少样本数
  roi_margin: 1.3            # ROI 扩展系数 (1.0 = 无扩展)
  min_roi_size: 200          # 最小 ROI 尺寸
  
  # 预处理参数
  enable_clahe: true         # 是否启用 CLAHE (推荐开启)
  clahe_clip_limit: 2.0      # CLAHE clip limit


# ==================== 拓扑拟合配置 ====================
topology:
  # 模板参数
  template_scale: 50.0       # 模板点间距 (像素)，根据实际芯片尺寸调整
  template_path: null        # 自定义模板文件路径 (JSON)，null 使用默认十字模板
  
  # RANSAC 参数
  ransac_iters: 200          # RANSAC 迭代次数
  ransac_threshold: 25.0     # 内点阈值 (像素)
  min_inliers: 4             # 最少内点数
  
  # 可见性判定
  visibility_margin: 10      # 边界安全距离 (像素)
  
  # 暗腔室判定
  brightness_roi_size: 30    # 亮度判定 ROI 尺寸
  dark_percentile: 25.0      # 暗腔室判定分位数阈值 (亮度低于该分位数的为暗腔室)
  
  # 回退参数
  fallback_to_affine: true   # Similarity 失败时是否回退到 Affine


# ==================== 说明 ====================
# 
# 1. cluster_eps 调参建议：
#    - 如果腔室间距约 50px，建议 eps=100~150
#    - 如果远景图腔室间距小，可能需要减小 eps
#
# 2. template_scale 调参建议：
#    - 该参数应与实际芯片的腔室间距比例一致
#    - 默认 50.0 表示相邻腔室距离约 50px
#
# 3. 自定义模板文件格式 (JSON):
#    {
#      "template": [
#        [0, -1], [0, -2], [0, -3],  // Top arm
#        [1, 0], [2, 0], [3, 0],     // Right arm
#        [0, 1], [0, 2], [0, 3],     // Bottom arm
#        [-1, 0], [-2, 0], [-3, 0]   // Left arm
#      ],
#      "description": "Cross template for 12 chambers"
#    }
